# Ansible + Docker Local Lab Setup (Using PEM Key)

Install Ansible and Docker on Your Host Machine

Update system:

```
sudo apt update
```

Install Docker:

```
sudo apt install -y docker.io
sudo systemctl start docker
sudo systemctl enable docker
```

Install Ansible:

```
sudo apt install -y ansible
```

Verify installations:

```
docker --version
ansible --version
```

---

## 2. Generate PEM Key for SSH Authentication

Create SSH key pair (PEM style like cloud servers):

```
ssh-keygen -t rsa -b 4096 -f ansible-key.pem
```

This creates:

* `ansible-key.pem` (private key)
* `ansible-key.pem.pub` (public key)

Set correct permission for private key:

```
chmod 400 ansible-key.pem
```

---

## 3. Prepare Docker Environment

### 3.1 Pull Ubuntu Image

```
docker pull ubuntu:22.04
```

### 3.2 Create Docker Network

```
docker network create ansible-lab
```

This network allows containers to communicate like real servers.

---

## 4. Create Ubuntu Servers as Docker Containers

### 4.1 Run Ubuntu Server 1

```
docker run -dit \
--name ubuntu-server-1 \
--hostname server1 \
--network ansible-lab \
ubuntu:22.04
```

### 4.2 Run Ubuntu Server 2

```
docker run -dit \
--name ubuntu-server-2 \
--hostname server2 \
--network ansible-lab \
ubuntu:22.04
```

Verify containers:

```
docker ps
```

---

## 5. Configure SSH Inside Containers

### 5.1 Access Container

```
docker exec -it ubuntu-server-1 bash
```

### 5.2 Install SSH and Required Packages

```
apt update
apt install -y openssh-server sudo
mkdir /var/run/sshd
```

---

## 6. Create SSH User

Create a user named `devops`:

```
useradd -m -s /bin/bash devops
```

Create SSH directory:

```
mkdir /home/devops/.ssh
chmod 700 /home/devops/.ssh
```

---

## 7. Configure PEM Key Authentication

### 7.1 Add Public Key

Open authorized keys file:

```
nano /home/devops/.ssh/authorized_keys
```

Paste the content of:

```
ansible-key.pem.pub
```

Save and exit.

### 7.2 Set Correct Permissions

```
chmod 600 /home/devops/.ssh/authorized_keys
chown -R devops:devops /home/devops/.ssh
```

---

## 8. Enable and Start SSH Service

Edit SSH configuration:

```
nano /etc/ssh/sshd_config
```

Ensure the following values:

```
PubkeyAuthentication yes
PasswordAuthentication no
PermitRootLogin no
```

Start SSH service:

```
service ssh start
```

Exit container:

```
exit
```

---

## 9. Repeat Configuration for Second Server

Repeat **steps 5 to 8** for:

```
ubuntu-server-2
```

---

## 10. Get Container IP Addresses

```
docker inspect ubuntu-server-1 | grep IPAddress
docker inspect ubuntu-server-2 | grep IPAddress
```

---

## 11. SSH Into Containers Using PEM Key

From host machine:

```
ssh -i ansible-key.pem devops@<server1-ip>
ssh -i ansible-key.pem devops@<server2-ip>
```

---

## 12. Result

* Two Ubuntu servers running as Docker containers
* SSH access using PEM key (no password)
* Containers behave like real servers
* Ready for Ansible automation and DevOps practice

---

## 13. Next Steps (Optional)

* Configure Ansible inventory with PEM key
* Install Docker inside containers using Ansible
* Deploy Nginx / MySQL containers
* Practice CI/CD and Kubernetes later

---


